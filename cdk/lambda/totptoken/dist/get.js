var T=Object.create;var o=Object.defineProperty;var k=Object.getOwnPropertyDescriptor;var w=Object.getOwnPropertyNames;var N=Object.getPrototypeOf,b=Object.prototype.hasOwnProperty;var v=(e,t)=>{for(var n in t)o(e,n,{get:t[n],enumerable:!0})},l=(e,t,n,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of w(t))!b.call(e,r)&&r!==n&&o(e,r,{get:()=>t[r],enumerable:!(s=k(t,r))||s.enumerable});return e};var D=(e,t,n)=>(n=e!=null?T(N(e)):{},l(t||!e||!e.__esModule?o(n,"default",{value:e,enumerable:!0}):n,e)),R=e=>l(o({},"__esModule",{value:!0}),e);var C={};v(C,{getResData:()=>x,getSecretKey:()=>I,getTotp:()=>S});module.exports=R(C);var u=require("@aws-sdk/client-dynamodb");var a=require("@aws-sdk/client-secrets-manager"),A=new a.SecretsManagerClient({region:process.env.AWS_REGION}),m=async()=>{let e=await A.send(new a.GetSecretValueCommand({SecretId:`amfa/${process.env.TENANT_ID}/secret`,VersionStage:"AWSCURRENT"}));return JSON.parse(e.SecretString)};var d=D(require("crypto"),1),E=({toDecrypt:e,aesKey:t})=>{let n=d.createDecipheriv("aes-128-ecb",t,"");return n.update(e,"base64","utf8")+n.final("utf8")},i=async(e,t,n)=>{let s={TableName:process.env.TOTPTOKEN_TABLE,Key:{id:{S:e.trim()+"#"+t?.trim()}}},r=await n.send(new u.GetItemCommand(s));console.log("get totp token result",r);let c=r.Item;return c&&c.token?{token:c.token.S,device_name:c.device_name.S,email:e}:null},I=async(e,t)=>{let{email:n,pid:s}=e,r=await i(n,s,t);if(console.log("totpTokenDB readResult",r),r){let c=r.token,p=await m(),_=p?.Mobile_Token_Key,g=p?.Mobile_Token_Salt,y=`${_}${g}`+n.substring(0,n.length/2),f=Buffer.from(y,"utf8").toString("base64").substring(0,16);return E({toDecrypt:c,aesKey:f})}return null},S=async(e,t,n)=>(await i(e,t,n))?.device_name,x=async(e,t,n)=>{switch(n){case"n":return await S(e.email,e.pid,t);case"c":return await i(e.email,e.pid,t);default:break}return null};0&&(module.exports={getResData,getSecretKey,getTotp});
//# sourceMappingURL=get.js.map
